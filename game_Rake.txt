local Players = game:GetService("Players")

-- é»‘åå•åˆ—è¡¨ï¼ˆä½¿ç”¨ASCIIç¼–ç è¡¨ç¤ºç”¨æˆ·åï¼‰
local blacklist = {
    "",
    
}

-- åˆ›å»ºé»‘åå•æŸ¥æ‰¾è¡¨
local blacklistLookup = {}
for _, name in ipairs(blacklist) do
    blacklistLookup[name:lower()] = true
end

-- æ£€æŸ¥ç©å®¶æ˜¯å¦åœ¨é»‘åå•ä¸­
local function isPlayerBlacklisted(player)
    return blacklistLookup[player.Name:lower()] == true
end

-- ç©å®¶åŠ å…¥æ—¶çš„å¤„ç†å‡½æ•°
local function onPlayerAdded(player)
    if isPlayerBlacklisted(player) then
        player:Kick("ä½ åœ¨é»‘åå•ä¸­ï¼Œæ— æ³•è¿›å…¥æ¸¸æˆ")
        print("å·²é˜»æ­¢é»‘åå•ç©å®¶è¿›å…¥: " .. player.Name)
    else
        print("ç©å®¶ " .. player.Name .. " å·²åŠ å…¥æ¸¸æˆ")
    end
end

-- æ£€æŸ¥å·²ç»åœ¨çº¿ç©å®¶
for _, player in ipairs(Players:GetPlayers()) do
    task.spawn(onPlayerAdded, player)
end

-- ç›‘å¬æ–°ç©å®¶åŠ å…¥äº‹ä»¶
Players.PlayerAdded:Connect(onPlayerAdded)

print("é»‘åå•ç³»ç»Ÿå·²åŠ è½½ï¼Œå½“å‰é»‘åå•äººæ•°: " .. #blacklist)
print("âœ… ç­‰å¾…ç»“æŸï¼Œå¼€å§‹æ‰§è¡Œä¸»è„šæœ¬...")

-- åœ¨è¿™é‡Œæ‹¼æ¥ä½ çš„ä¸»è„šæœ¬
-- ä½ çš„ä¸»è„šæœ¬å†…å®¹ä»è¿™é‡Œå¼€å§‹...
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local SoundService = game:GetService("SoundService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- åˆ›å»ºä¸»å±å¹•GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "DoorScriptNotice"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- åˆ›å»ºä¸»æ¡†æ¶
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

-- æ·»åŠ åœ†è§’
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- åˆ›å»ºé¡¶éƒ¨è£…é¥°æ¡
local topBar = Instance.new("Frame")
topBar.Name = "TopBar"
topBar.Size = UDim2.new(1, 0, 0, 4)
topBar.Position = UDim2.new(0, 0, 0, 0)
topBar.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
topBar.BorderSizePixel = 0
topBar.Parent = mainFrame

-- åˆ›å»ºæ ‡é¢˜
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -40, 0, 30)
title.Position = UDim2.new(0, 20, 0, 10)
title.BackgroundTransparency = 1
title.Text = "# NY"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = mainFrame

-- åˆ›å»ºå‰¯æ ‡é¢˜
local subtitle = Instance.new("TextLabel")
subtitle.Name = "Subtitle"
subtitle.Size = UDim2.new(1, -40, 0, 20)
subtitle.Position = UDim2.new(0, 20, 0, 40)
subtitle.BackgroundTransparency = 1
subtitle.Text = "## NYè„šæœ¬ | å…¬å‘Š | 3.0ç‰ˆæœ¬ ##"
subtitle.TextColor3 = Color3.fromRGB(200, 200, 200)
subtitle.TextScaled = true
subtitle.Font = Enum.Font.Gotham
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.Parent = mainFrame

-- åˆ›å»ºæç¤ºæ–‡æœ¬
local notice = Instance.new("TextLabel")
notice.Name = "Notice"
notice.Size = UDim2.new(1, -40, 0, 25)
notice.Position = UDim2.new(0, 20, 0, 65)
notice.BackgroundTransparency = 1
notice.Text = "å¿…çœ‹æç¤ºï¼ï¼ï¼"
notice.TextColor3 = Color3.fromRGB(255, 100, 100)
notice.TextScaled = true
notice.Font = Enum.Font.GothamBold
notice.TextXAlignment = Enum.TextXAlignment.Left
notice.Parent = mainFrame

-- åˆ›å»ºåˆ†éš”çº¿
local separator = Instance.new("Frame")
separator.Name = "Separator"
separator.Size = UDim2.new(1, -40, 0, 2)
separator.Position = UDim2.new(0, 20, 0, 95)
separator.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
separator.BorderSizePixel = 0
separator.Parent = mainFrame

-- åˆ›å»ºå…¬å‘Šå†…å®¹æ–‡æœ¬
local content = Instance.new("TextLabel")
content.Name = "Content"
content.Size = UDim2.new(1, -40, 0, 130)
content.Position = UDim2.new(0, 20, 0, 105)
content.BackgroundTransparency = 1
content.Text = "ä½œè€…ï¼šğŸ˜è¯ºäºšğŸ˜ ä¸ºrakeæœåŠ¡å™¨æ‰“é€   ğŸ‘»ç©å®¶è¿½è¸ª rakeè¿½è¸ª åºŸé‡‘å±è¿½è¸ª å¤œè§† åŠ é€Ÿ åœ°ç‚¹æ ‡è®°ğŸ‘»     3.0ç‰ˆæœ¬ï¼šæ–°å¢ç©ºæŠ•è¿½è¸ªå’Œä¿¡å·æŠ¢è¿½è¸ª å¾®å°æ–‡å­—æ”¹åŠ¨     å°ä½œåŠ åŠŸèƒ½ç•¥æœ‰ä¸è¶³ è¯·è§è°… åç»­ä¼šç»§ç»­æ›´æ–°(å…ˆç­‰ä¸ªä¸€è¾ˆå­å†è¯´) æœ€åç¥æ‚¨ç©çš„æ„‰å¿«"
content.TextColor3 = Color3.fromRGB(220, 220, 220)
content.TextSize = 16
content.TextWrapped = true
content.Font = Enum.Font.Gotham
content.TextXAlignment = Enum.TextXAlignment.Left
content.TextYAlignment = Enum.TextYAlignment.Top
content.Parent = mainFrame

-- åˆ›å»ºç¡®è®¤æŒ‰é’®
local confirmButton = Instance.new("TextButton")
confirmButton.Name = "ConfirmButton"
confirmButton.Size = UDim2.new(0, 120, 0, 35)
confirmButton.Position = UDim2.new(0.5, -60, 1, -50)
confirmButton.AnchorPoint = Vector2.new(0.5, 0)
confirmButton.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
confirmButton.Text = "ç¡®è®¤"
confirmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
confirmButton.TextSize = 16
confirmButton.Font = Enum.Font.GothamBold
confirmButton.Parent = mainFrame

-- æŒ‰é’®åœ†è§’
local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 4)
buttonCorner.Parent = confirmButton

-- æ·»åŠ æŒ‰é’®æ‚¬åœæ•ˆæœ
confirmButton.MouseEnter:Connect(function()
    TweenService:Create(confirmButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(30, 144, 255)}):Play()
end)

confirmButton.MouseLeave:Connect(function()
    TweenService:Create(confirmButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 162, 255)}):Play()
end)

-- åˆ›å»ºå…¨å±€å˜é‡ç”¨äºå­˜å‚¨ç¡®è®¤çŠ¶æ€
_G.AYScriptConfirmed = false

-- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
confirmButton.MouseButton1Click:Connect(function()
    -- æ’­æ”¾ç¡®è®¤éŸ³æ•ˆ
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://170765130"
    sound.Parent = SoundService
    sound:Play()
    
    -- ç­‰å¾…éŸ³æ•ˆæ’­æ”¾å®Œæˆ
    wait(0.5)
    
    TweenService:Create(mainFrame, TweenInfo.new(0.3), {Size = UDim2.new(0, 400, 0, 0)}):Play()
    wait(0.3)
    screenGui:Destroy()
    _G.AYScriptConfirmed = true
end)

-- æ·»åŠ å…¥åœºåŠ¨ç”»
mainFrame.Size = UDim2.new(0, 400, 0, 0)
TweenService:Create(mainFrame, TweenInfo.new(0.5), {Size = UDim2.new(0, 400, 0, 300)}):Play()

-- æ·»åŠ å±å¹•å°ºå¯¸å˜åŒ–æ—¶çš„è‡ªé€‚åº”
local function updatePosition()
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
end

-- ç›‘å¬å±å¹•å°ºå¯¸å˜åŒ–
game:GetService("RunService").RenderStepped:Connect(updatePosition)

-- ç­‰å¾…ç”¨æˆ·ç¡®è®¤
while not _G.AYScriptConfirmed do
    wait(0.1)
end

-- ç”¨æˆ·ç¡®è®¤åï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„è„šæœ¬
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

-- ===== ESP é…ç½®åŒºåŸŸ =====
local SETTINGS = {
    ENEMY_TAGS = {"Rake", "Monster", "Enemy"},
    ENEMY_COLOR = Color3.fromRGB(255, 50, 50),
    
    PLAYER_COLOR = Color3.fromRGB(50, 150, 255),
    TEAM_COLOR = Color3.fromRGB(50, 255, 100),
    
    SHOW_HEALTH = true,
    SHOW_DISTANCE = true,
    SHOW_TRACER = true,
    TRACER_COLOR = Color3.fromRGB(0, 150, 255),
    ENEMY_TRACER_COLOR = Color3.fromRGB(255, 50, 50),
    TRACER_THICKNESS = 0.1,
    
    MAX_DISTANCE = 1000,
    HEALTH_TEXT_SIZE = 16,
    DISTANCE_TEXT_SIZE = 14,
    NAME_TEXT_SIZE = 18,
    UPDATE_RATE = 0.005,
    
    SCAN_INTERVAL = 5,
    TRACER_FOR_ENEMIES = true,
    
    HIGHLIGHT_DISABLE_DISTANCE = 4  
}

-- ç‹¬ç«‹çš„ESPå¼€å…³çŠ¶æ€ - å…¨éƒ¨é»˜è®¤å…³é—­
local playerEspEnabled = false
local enemyEspEnabled = false
local trashEspEnabled = false
local nightVisionEnabled = false
local flareGunEspEnabled = false  -- ä¿¡å·æªé€è§†å¼€å…³
local airdropEspEnabled = false   -- ç©ºæŠ•é€è§†å¼€å…³

-- é€Ÿåº¦æ§åˆ¶å˜é‡ - é»˜è®¤å…³é—­
local TARGET_SPEED = 26
local isSpeedBoostEnabled = false
local currentHumanoid = nil
local speedMaintainConnection = nil

-- åœ°ç‚¹æ ‡è®°å˜é‡ - é»˜è®¤å…³é—­
local isLocationMarkersEnabled = false
local markerPositions = {
    watchtower = Vector3.new(48.06, 57.82, -46.03),   -- ç­æœ›å¡”åæ ‡
    redhouse = Vector3.new(-36.38, 17.61, 200.02),    -- çº¢æˆ¿åæ ‡
    safehouse = Vector3.new(-359.93, 15.37, 69.19),   -- å®‰å…¨å±‹åæ ‡
    powerstation = Vector3.new(-308.60, 20.00, -208.13), -- å‘ç”µç«™åæ ‡
    store = Vector3.new(-25.96, 16.31, -252.33),      -- å•†åº—åæ ‡
    rakenest = Vector3.new(-154.01, 19.84, 29.52)     -- Rakeè€å·¢åæ ‡
}

local markerConfigs = {
    watchtower = {
        text = "ç­æœ›å¡”\n  Â·",
        color = Color3.fromRGB(170, 0, 255)  -- ç´«è‰²
    },
    redhouse = {
        text = "çº¢æˆ¿\n Â·",
        color = Color3.fromRGB(255, 50, 50)  -- äº®çº¢è‰²
    },
    safehouse = {
        text = "å®‰å…¨å±‹\n  Â·",
        color = Color3.fromRGB(50, 255, 50)  -- ç»¿è‰²
    },
    powerstation = {
        text = "å‘ç”µç«™\n  Â·",
        color = Color3.fromRGB(139, 69, 19)  -- æ£•è‰²
    },
    store = {
        text = "å•†åº—\n Â·",
        color = Color3.fromRGB(0, 100, 255)  -- è“è‰²
    },
    rakenest = {
        text = "Rakeè€å·¢\n   Â·",
        color = Color3.fromRGB(255, 255, 0)  -- é»„è‰²
    }
}

local markers = {}

local espCache = {}
local lastScanTime = 0
local nightVisionConnection

-- ===== ä¿¡å·æªé€è§†é…ç½® =====
local flareGunConfig = {
    maxDistance = 2000, -- æœ€å¤§æ£€æµ‹è·ç¦»(stud)
    highlightColor = Color3.fromRGB(255, 50, 50), -- é«˜äº®é¢œè‰²(çº¢è‰²ç³»)
    highlightTransparency = 0.3, -- é€æ˜åº¦
    scanInterval = 1, -- å…¨å›¾æ‰«æé—´éš”(ç§’)
    updateInterval = 0.1, -- æ›´æ–°é—´éš”(ç§’)
    labelColor = Color3.fromRGB(255, 150, 150), -- æ ‡ç­¾é¢œè‰²(æ·¡çº¢è‰²)
    labelSize = 15, -- æ ‡ç­¾å­—ä½“å¤§å°
    maxLabels = 50, -- æœ€å¤§æ˜¾ç¤ºæ ‡ç­¾æ•°é‡
    tagPrefix = "[ä¿¡å·æª]", -- æ ‡ç­¾å‰ç¼€
    scanKey = Enum.KeyCode.T, -- å…¨å›¾æ‰«æå¿«æ·é”®
    notificationDuration = 3, -- æç¤ºæ˜¾ç¤ºæ—¶é—´(ç§’)
    notificationColor = Color3.fromRGB(139, 0, 0), -- æ·±çº¢è‰²æç¤º
    notificationCooldown = 30 -- æç¤ºå†·å´æ—¶é—´(ç§’)
}

-- ===== ç©ºæŠ•é€è§†é…ç½® =====
local airdropConfig = {
    maxDistance = 2000, -- æœ€å¤§æ£€æµ‹è·ç¦»(stud)
    scanInterval = 1, -- å…¨å›¾æ‰«æé—´éš”(ç§’)
    updateInterval = 0.1, -- æ›´æ–°é—´éš”(ç§’)
    labelSize = 15, -- æ ‡ç­¾å­—ä½“å¤§å°
    maxLabels = 50, -- æœ€å¤§æ˜¾ç¤ºæ ‡ç­¾æ•°é‡
    scanKey = Enum.KeyCode.Y, -- å…¨å›¾æ‰«æå¿«æ·é”®(ä½¿ç”¨ä¸åŒçš„æŒ‰é”®)
    
    -- ä¸æ˜¾ç¤ºä»»ä½•æ ‡ç­¾çš„åŒºåŸŸè®¾ç½®
    noDisplayZone = {
        center = Vector3.new(-365.87, 16.39, 73.87), -- åŒºåŸŸä¸­å¿ƒåæ ‡
        radius = 10 -- åŒºåŸŸåŠå¾„(stud)
    },
    
    -- å¯†é›†åŒºåŸŸè®¾ç½®
    denseArea = {
        radius = 15, -- å¯†é›†åŒºåŸŸåŠå¾„(stud)
        threshold = 6, -- è§¦å‘å¯†é›†å¤„ç†çš„åºŸæ–™æ•°é‡é˜ˆå€¼
        airdropPrefix = "[ç©ºæŠ•]", -- å¯†é›†åŒºåŸŸæ˜¾ç¤ºçš„å‰ç¼€
        airdropColor = Color3.fromRGB(139, 0, 0) -- æ·±çº¢è‰²
    }
}

-- ===== ä¿¡å·æªé€è§†å˜é‡ =====
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local camera = workspace.CurrentCamera

local flareGunHighlightedItems = {}
local flareGunItemCache = {}
local flareGunLastScanTime = 0
local flareGunScanning = false
local flareGunLastNotificationTime = 0
local flareGunNotificationGui = nil
local flareGunNotificationCooldown = 0 -- æç¤ºå†·å´è®¡æ—¶å™¨

-- ===== ç©ºæŠ•é€è§†å˜é‡ =====
local airdropLabeledTrash = {}
local airdropTrashCache = {}
local airdropLastScanTime = 0
local airdropScanning = false

-- ===== é«˜çº§åºŸæ–™é€è§†è„šæœ¬ =====
local trashConfig = {
    maxDistance = 2000, -- æœ€å¤§æ£€æµ‹è·ç¦»(stud)
    highlightColor = Color3.fromRGB(0, 255, 0), -- é«˜äº®é¢œè‰²
    highlightTransparency = 0.3, -- é€æ˜åº¦
    scanInterval = 1, -- å…¨å›¾æ‰«æé—´éš”(ç§’)
    updateInterval = 0.1, -- æ›´æ–°é—´éš”(ç§’)
    labelColor = Color3.fromRGB(210, 180, 140), -- æ ‡ç­¾é¢œè‰²ï¼ˆæµ…æ£•è‰²ï¼‰
    labelSize = 15, -- æ ‡ç­¾å­—ä½“å¤§å°
    maxLabels = 50, -- æœ€å¤§æ˜¾ç¤ºæ ‡ç­¾æ•°é‡
    tagPrefix = "[åºŸæ–™]", -- æ ‡ç­¾å‰ç¼€
    scanKey = Enum.KeyCode.T, -- å…¨å›¾æ‰«æå¿«æ·é”®
    denseThreshold = 6, -- å¯†é›†åºŸæ–™é˜ˆå€¼
    denseRadius = 15 -- å¯†é›†åŒºåŸŸåŠå¾„(stud)
}

-- å­˜å‚¨å·²é«˜äº®çš„åºŸæ–™
local highlightedTrash = {}
local trashCache = {}
local lastScanTimeTrash = 0
local trashScanning = false

-- ===== åœ°ç‚¹æ ‡è®°åŠŸèƒ½ =====
local function createMarker(position, text, color)
    -- åˆ›å»ºå¹¿å‘Šç‰ŒGUIçš„å®¹å™¨
    local part = Instance.new("Part")
    part.Anchored = true
    part.CanCollide = false
    part.Transparency = 1  -- å®Œå…¨é€æ˜ï¼Œæˆ‘ä»¬åªéœ€è¦å®ƒçš„ä½ç½®
    part.Size = Vector3.new(2, 2, 2)
    part.Position = position
    part.Parent = workspace
    
    -- åˆ›å»ºå¹¿å‘Šç‰ŒGUI
    local billboard = Instance.new("BillboardGui")
    billboard.Adornee = part
    billboard.Size = UDim2.new(0, 200, 0, 80)
    billboard.StudsOffset = Vector3.new(0, 3, 0)  -- åœ¨éƒ¨ä»¶ä¸Šæ–¹æ˜¾ç¤º
    billboard.AlwaysOnTop = true
    billboard.Enabled = isLocationMarkersEnabled  -- æ ¹æ®å½“å‰çŠ¶æ€è®¾ç½®å¯è§æ€§
    
    -- åˆ›å»ºæ–‡æœ¬æ ‡ç­¾
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.Font = Enum.Font.SourceSansBold
    label.TextColor3 = color
    label.TextSize = 24
    label.TextStrokeTransparency = 0.8  -- æ–‡å­—æè¾¹ï¼Œä½¿å…¶åœ¨å„ç§èƒŒæ™¯ä¸‹éƒ½æ¸…æ™°å¯è§
    label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    label.Parent = billboard
    
    billboard.Parent = part
    
    return part
end

-- åˆ›å»ºæ‰€æœ‰æ ‡è®°
local function createAllMarkers()
    for markerType, position in pairs(markerPositions) do
        markers[markerType] = createMarker(
            position, 
            markerConfigs[markerType].text, 
            markerConfigs[markerType].color
        )
    end
end

-- åˆ‡æ¢åœ°ç‚¹æ ‡è®°çŠ¶æ€
local function toggleLocationMarkers()
    isLocationMarkersEnabled = not isLocationMarkersEnabled
    
    -- æ›´æ–°æ‰€æœ‰æ ‡è®°çš„å¯è§æ€§
    for _, marker in pairs(markers) do
        if marker and marker:FindFirstChild("BillboardGui") then
            marker.BillboardGui.Enabled = isLocationMarkersEnabled
        end
    end
    
    return isLocationMarkersEnabled
end

-- åˆå§‹åŒ–åœ°ç‚¹æ ‡è®°
createAllMarkers()

-- ===== é€Ÿåº¦æ§åˆ¶åŠŸèƒ½ =====
local function maintainSpeed()
    if currentHumanoid and currentHumanoid:IsDescendantOf(workspace) then
        currentHumanoid.WalkSpeed = TARGET_SPEED
    end
end

local function setupSpeedMaintenance()
    if speedMaintainConnection then
        speedMaintainConnection:Disconnect()
        speedMaintainConnection = nil
    end
    
    if isSpeedBoostEnabled then
        speedMaintainConnection = RunService.Heartbeat:Connect(function()
            maintainSpeed()
        end)
    end
end

local function initializeCharacter(character)
    local humanoid = character:WaitForChild("Humanoid")
    currentHumanoid = humanoid
    
    if isSpeedBoostEnabled then
        maintainSpeed()
        setupSpeedMaintenance()
    end
    
    humanoid:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
        if isSpeedBoostEnabled then
            maintainSpeed()
        end
    end)
end

local function toggleSpeedBoost()
    isSpeedBoostEnabled = not isSpeedBoostEnabled
    
    if isSpeedBoostEnabled then
        if currentHumanoid and currentHumanoid:IsDescendantOf(workspace) then
            maintainSpeed()
            setupSpeedMaintenance()
        end
    else
        if currentHumanoid and currentHumanoid:IsDescendantOf(workspace) then
            currentHumanoid.WalkSpeed = 16
        end
        
        if speedMaintainConnection then
            speedMaintainConnection:Disconnect()
            speedMaintainConnection = nil
        end
    end
    
    return isSpeedBoostEnabled
end

-- åˆå§‹åŒ–è§’è‰²é€Ÿåº¦æ§åˆ¶
if LocalPlayer.Character then
    initializeCharacter(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(initializeCharacter)
LocalPlayer.CharacterRemoving:Connect(function()
    if speedMaintainConnection then
        speedMaintainConnection:Disconnect()
        speedMaintainConnection = nil
    end
    currentHumanoid = nil
end)

-- ===== ESP åŠŸèƒ½å‡½æ•° =====
local function shouldShowESP(target, data)
    if not target.Parent then return false end
    
    local isEnemy = false
    for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
        if target.Name:find(tag) or target:FindFirstChild(tag) then
            isEnemy = true
            break
        end
    end
    
    local isTeammate = false
    if not isEnemy and target:FindFirstChild("Team") then
        if LocalPlayer.Team and target.Team == LocalPlayer.Team then
            isTeammate = true
        end
    end
    
    if isEnemy then
        return enemyEspEnabled
    elseif isTeammate then
        return playerEspEnabled
    else
        return playerEspEnabled
    end
end

local function createESP(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    
    if espCache[target] then return end
    
    local isEnemy = false
    local isTeammate = false
    local espColor = SETTINGS.PLAYER_COLOR
    
    for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
        if target.Name:find(tag) or target:FindFirstChild(tag) then
            isEnemy = true
            espColor = SETTINGS.ENEMY_COLOR
            break
        end
    end
    
    if not isEnemy and target:FindFirstChild("Team") then
        if LocalPlayer.Team and target.Team == LocalPlayer.Team then
            isTeammate = true
            espColor = SETTINGS.TEAM_COLOR
        end
    end
    
    local highlight = Instance.new("Highlight")
    highlight.Name = "AdvancedESP_Highlight"
    highlight.FillColor = espColor
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.3
    highlight.OutlineTransparency = 0
    highlight.Parent = target
    
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "AdvancedESP_Billboard"
    billboard.Adornee = target.HumanoidRootPart
    billboard.Size = UDim2.new(0, 150, 0, 60)
    billboard.StudsOffset = Vector3.new(0, 3.5, 0)
    billboard.AlwaysOnTop = true
    billboard.Enabled = shouldShowESP(target, {isEnemy = isEnemy, isTeammate = isTeammate})
    billboard.Parent = target
    
    local distanceText = Instance.new("TextLabel")
    distanceText.Name = "ESP_Distance"
    distanceText.Size = UDim2.new(1, 0, 0.3, 0)
    distanceText.Position = UDim2.new(0, 0, 0, 0)
    distanceText.BackgroundTransparency = 1
    distanceText.TextColor3 = Color3.fromRGB(200, 200, 255)
    distanceText.TextStrokeTransparency = 0.5
    distanceText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceText.TextSize = SETTINGS.DISTANCE_TEXT_SIZE
    distanceText.Font = Enum.Font.SourceSansBold
    distanceText.TextXAlignment = Enum.TextXAlignment.Center
    distanceText.Parent = billboard
    
    local healthText = Instance.new("TextLabel")
    healthText.Name = "ESP_Health"
    healthText.Size = UDim2.new(1, 0, 0.4, 0)
    healthText.Position = UDim2.new(0, 0, 0.3, 0)
    healthText.BackgroundTransparency = 1
    healthText.TextColor3 = Color3.fromRGB(255, 255, 255)
    healthText.TextStrokeTransparency = 0.5
    healthText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    healthText.TextSize = SETTINGS.HEALTH_TEXT_SIZE
    healthText.Font = Enum.Font.SourceSansBold
    healthText.TextXAlignment = Enum.TextXAlignment.Center
    healthText.Parent = billboard
    
    local nameText = Instance.new("TextLabel")
    nameText.Name = "ESP_Name"
    nameText.Size = UDim2.new(1, 0, 0.3, 0)
    nameText.Position = UDim2.new(0, 0, 0.7, 0)
    nameText.BackgroundTransparency = 1
    nameText.TextColor3 = espColor
    nameText.TextStrokeTransparency = 0.5
    nameText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameText.TextSize = SETTINGS.NAME_TEXT_SIZE
    nameText.Font = Enum.Font.SourceSansBold
    nameText.TextXAlignment = Enum.TextXAlignment.Center
    nameText.Parent = billboard
    
    local tracer
    if SETTINGS.SHOW_TRACER and (not isEnemy or SETTINGS.TRACER_FOR_ENEMIES) then
        local startAttachment = Instance.new("Attachment")
        startAttachment.Name = "TracerStart"
        startAttachment.Parent = workspace.CurrentCamera
        
        local endAttachment = Instance.new("Attachment")
        endAttachment.Name = "TracerEnd"
        endAttachment.Parent = target.HumanoidRootPart
        
        tracer = Instance.new("Beam")
        tracer.Name = "ESP_Tracer"
        tracer.Attachment0 = startAttachment
        tracer.Attachment1 = endAttachment
        tracer.Color = ColorSequence.new(isEnemy and SETTINGS.ENEMY_TRACER_COLOR or SETTINGS.TRACER_COLOR)
        tracer.Width0 = SETTINGS.TRACER_THICKNESS
        tracer.Width1 = SETTINGS.TRACER_THICKNESS * 0.8
        tracer.LightEmission = 0.8
        tracer.Transparency = NumberSequence.new(0.5)
        tracer.FaceCamera = true
        tracer.Enabled = shouldShowESP(target, {isEnemy = isEnemy, isTeammate = isTeammate})
        tracer.Parent = target.HumanoidRootPart
    end
    
    espCache[target] = {
        highlight = highlight,
        billboard = billboard,
        tracer = tracer,
        humanoid = target:FindFirstChildOfClass("Humanoid"),
        rootPart = target.HumanoidRootPart,
        startAttachment = tracer and tracer.Attachment0,
        endAttachment = tracer and tracer.Attachment1,
        isEnemy = isEnemy,
        isTeammate = isTeammate
    }
    
    -- æ ¹æ®å½“å‰ESPçŠ¶æ€è®¾ç½®é«˜äº®
    highlight.Enabled = shouldShowESP(target, {isEnemy = isEnemy, isTeammate = isTeammate})
end

local function fullScan()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            createESP(player.Character)
        end
    end
    
    for _, descendant in ipairs(workspace:GetDescendants()) do
        if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
            for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
                if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                    createESP(descendant)
                    break
                end
            end
        end
    end
end

-- ===== ESP æ›´æ–°å¾ªç¯ =====
local lastUpdate = 0

RunService.Heartbeat:Connect(function(deltaTime)
    lastUpdate = lastUpdate + deltaTime
    lastScanTime = lastScanTime + deltaTime
    
    if lastScanTime >= SETTINGS.SCAN_INTERVAL then
        lastScanTime = 0
        fullScan()
    end
    
    if lastUpdate < SETTINGS.UPDATE_RATE then return end
    lastUpdate = 0
    
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local localRoot = LocalPlayer.Character.HumanoidRootPart
    
    for target, data in pairs(espCache) do
        if not target.Parent then
            if data.highlight then data.highlight:Destroy() end
            if data.billboard then data.billboard:Destroy() end
            if data.tracer then data.tracer:Destroy() end
            espCache[target] = nil
        else
            local distance = (data.rootPart.Position - localRoot.Position).Magnitude
            local distanceInMeters = distance / 3.571
            local shouldShow = distance <= SETTINGS.MAX_DISTANCE and shouldShowESP(target, data)
            
            data.billboard.Enabled = shouldShow
            if data.tracer then
                data.tracer.Enabled = shouldShow
                if data.startAttachment then
                    data.startAttachment.WorldPosition = localRoot.Position - Vector3.new(0, 1.5, 0)
                end
            end
            
            if shouldShow then
                if distanceInMeters < SETTINGS.HIGHLIGHT_DISABLE_DISTANCE then
                    data.highlight.Enabled = false
                else
                    data.highlight.Enabled = true
                end
            else
                data.highlight.Enabled = false
            end
            
            if shouldShow then
                if SETTINGS.SHOW_DISTANCE then
                    data.billboard.ESP_Distance.Text = string.format("%.1fm", distanceInMeters)
                else
                    data.billboard.ESP_Distance.Text = ""
                end
                
                if SETTINGS.SHOW_HEALTH and data.humanoid then
                    data.billboard.ESP_Health.Text = string.format("HP: %d/%d", 
                        math.floor(data.humanoid.Health), 
                        math.floor(data.humanoid.MaxHealth))
                else
                    data.billboard.ESP_Health.Text = ""
                end
                
                data.billboard.ESP_Name.Text = target.Name
            end
        end
    end
end)

-- ===== ESP åˆå§‹åŒ–å’Œäº‹ä»¶ç›‘å¬ =====
fullScan()

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        createESP(character)
    end)
end)

workspace.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("Model") and descendant:FindFirstChild("HumanoidRootPart") then
        for _, tag in ipairs(SETTINGS.ENEMY_TAGS) do
            if descendant.Name:find(tag) or descendant:FindFirstChild(tag) then
                createESP(descendant)
                break
            end
        end
    end
end)

LocalPlayer.CharacterRemoving:Connect(function()
    for _, data in pairs(espCache) do
        if data.highlight then data.highlight:Destroy() end
        if data.billboard then data.billboard:Destroy() end
        if data.tracer then data.tracer:Destroy() end
    end
    espCache = {}
end)

-- ===== å¤œè§†åŠŸèƒ½ =====
local originalBrightness = Lighting.Brightness
local originalExposureCompensation = Lighting.ExposureCompensation
local originalClockTime = Lighting.ClockTime
local originalFogEnd = Lighting.FogEnd

local function enableNightVision()
    Lighting.Brightness = 1.8
    Lighting.ExposureCompensation = 1.4
    
    Lighting.ClockTime = 12
    
    if Lighting.FogEnd < 5000 then
        Lighting.FogEnd = 5000
    end
    
    if not Lighting:FindFirstChild("NightVisionBloom") then
        local bloom = Instance.new("BloomEffect")
        bloom.Name = "NightVisionBloom"
        bloom.Intensity = 0.1
        bloom.Threshold = 0.85
        bloom.Size = 16
        bloom.Parent = Lighting
    end
    
    if not Lighting:FindFirstChild("NightVisionColorCorrection") then
        local colorCorrection = Instance.new("ColorCorrectionEffect")
        colorCorrection.Name = "NightVisionColorCorrection"
        colorCorrection.Brightness = 0.12
        colorCorrection.Contrast = 0.2
        colorCorrection.Saturation = 0
        colorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
        colorCorrection.Parent = Lighting
    end
    
    if nightVisionConnection then
        nightVisionConnection:Disconnect()
    end
    
    nightVisionConnection = RunService.RenderStepped:Connect(function()
        if Lighting.Brightness < 1.6 then
            Lighting.Brightness = 1.8
        end
        
        if Lighting.ExposureCompensation < 1.3 then
            Lighting.ExposureCompensation = 1.4
        end
        
        if Lighting.ClockTime < 8 or Lighting.ClockTime > 16 then
            Lighting.ClockTime = 12
        end
        
        if Lighting.FogEnd < 5000 then
            Lighting.FogEnd = 5000
        end
        
        if not Lighting:FindFirstChild("NightVisionBloom") then
            local bloom = Instance.new("BloomEffect")
            bloom.Name = "NightVisionBloom"
            bloom.Intensity = 0.1
            bloom.Threshold = 0.85
            bloom.Size = 16
            bloom.Parent = Lighting
        end
        
        if not Lighting:FindFirstChild("NightVisionColorCorrection") then
            local colorCorrection = Instance.new("ColorCorrectionEffect")
            colorCorrection.Name = "NightVisionColorCorrection"
            colorCorrection.Brightness = 0.12
            colorCorrection.Contrast = 0.2
            colorCorrection.Saturation = 0
            colorCorrection.TintColor = Color3.fromRGB(255, 255, 255)
            colorCorrection.Parent = Lighting
        end
    end)
end

local function disableNightVision()
    if nightVisionConnection then
        nightVisionConnection:Disconnect()
        nightVisionConnection = nil
    end
    
    Lighting.Brightness = originalBrightness
    Lighting.ExposureCompensation = originalExposureCompensation
    Lighting.ClockTime = originalClockTime
    Lighting.FogEnd = originalFogEnd
    
    local bloom = Lighting:FindFirstChild("NightVisionBloom")
    if bloom then
        bloom:Destroy()
    end
    
    local colorCorrection = Lighting:FindFirstChild("NightVisionColorCorrection")
    if colorCorrection then
        colorCorrection:Destroy()
    end
end

local function toggleNightVision()
    nightVisionEnabled = not nightVisionEnabled
    
    if nightVisionEnabled then
        enableNightVision()
        print("å¤œè§†åŠŸèƒ½å·²å¯ç”¨")
    else
        disableNightVision()
        print("å¤œè§†åŠŸèƒ½å·²ç¦ç”¨")
    end
    
    return nightVisionEnabled
end

game:GetService("Players").LocalPlayer:GetPropertyChangedSignal("Parent"):Connect(function()
    if not game:GetService("Players").LocalPlayer.Parent then
        disableNightVision()
    end
end)

-- ===== é«˜çº§åºŸæ–™é€è§†åŠŸèƒ½ =====
local function studsToMeters(studs)
    return studs / 3.571
end

-- åˆ›å»ºåºŸæ–™æ ‡ç­¾å‡½æ•°
local function createTrashLabel(trashPart, distanceInStuds)
    if not trashEspEnabled then return nil end
    
    if not trashPart:FindFirstChild("TrashLabel") then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "TrashLabel"
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.Adornee = trashPart
        billboard.MaxDistance = trashConfig.maxDistance
        billboard.Enabled = trashEspEnabled
        
        local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = string.format("%s\n%.1fç±³", trashConfig.tagPrefix, studsToMeters(distanceInStuds))
    textLabel.TextColor3 = trashConfig.labelColor
    textLabel.TextSize = trashConfig.labelSize
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextStrokeTransparency = 0.5
    textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    
    textLabel.Parent = billboard
    billboard.Parent = trashPart
    
    return billboard
    end
    return trashPart:FindFirstChild("TrashLabel")
end

-- æ›´æ–°åºŸæ–™æ ‡ç­¾è·ç¦»
local function updateTrashLabel(trashPart, distanceInStuds)
    local label = trashPart:FindFirstChild("TrashLabel")
    if label then
        label.TextLabel.Text = string.format("%s\n%.1fç±³", trashConfig.tagPrefix, studsToMeters(distanceInStuds))
        
        -- æ ¹æ®è·ç¦»è°ƒæ•´æ ‡ç­¾å¤§å°
        local scale = math.clamp(1 - (distanceInStuds / trashConfig.maxDistance) * 0.5, 0.5, 1)
        label.TextLabel.TextSize = trashConfig.labelSize * scale
    end
end

-- é«˜äº®åºŸæ–™çš„å‡½æ•°
local function highlightTrash(trashPart)
    if not trashEspEnabled then return end
    
    if not highlightedTrash[trashPart] then
        local highlight = Instance.new("Highlight")
        highlight.Name = "TrashHighlight"
        highlight.FillColor = trashConfig.highlightColor
        highlight.FillTransparency = trashConfig.highlightTransparency
        highlight.OutlineColor = trashConfig.highlightColor
        highlight.OutlineTransparency = 0
        highlight.Adornee = trashPart
        highlight.Enabled = trashEspEnabled
        highlight.Parent = trashPart
        
        highlightedTrash[trashPart] = highlight
    end
end

-- æ£€æŸ¥æ˜¯å¦å¤„äºå¯†é›†åŒºåŸŸ
local function isInDenseArea(trashPart, nearbyTrash)
    local count = 0
    local pos = trashPart.Position
    
    for _, otherTrash in ipairs(nearbyTrash) do
        if otherTrash ~= trashPart and (pos - otherTrash.Position).Magnitude <= trashConfig.denseRadius then
            count = count + 1
            if count >= trashConfig.denseThreshold then
                return true
            end
        end
    end
    
    return false
end

-- å…¨å›¾æ‰«æåºŸæ–™
local function fullScanTrash()
    if trashScanning or not trashEspEnabled then return end
    trashScanning = true
    
    local startTime = os.clock()
    trashCache = {}
    
    -- æ‰©å±•æœç´¢æ¡ä»¶
    local trashKeywords = {"trash", "scrap", "junk", "waste", "debris", "rubbish", "garbage", "åºŸæ–™", "åƒåœ¾"}
    
    -- æ‰«æå·¥ä½œåŒº
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local lowerName = obj.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    table.insert(trashCache, obj)
                    break
                end
            end
        end
    end
    
    -- æ‰«ææ¨¡å‹
    for _, model in ipairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local lowerName = model.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    for _, part in ipairs(model:GetDescendants()) do
                        if part:IsA("BasePart") then
                            table.insert(trashCache, part)
                        end
                    end
                    break
                end
            end
        end
    end
    
    trashScanning = false
    lastScanTimeTrash = os.clock()
    print(string.format("å…¨å›¾æ‰«æå®Œæˆï¼Œæ‰¾åˆ° %d ä¸ªåºŸæ–™ï¼Œè€—æ—¶ %.2f ç§’", #trashCache, os.clock() - startTime))
end

-- æ¸…é™¤ä¸å†éœ€è¦çš„åºŸæ–™é«˜äº®
local function cleanUpHighlights(currentTrash)
    for trashPart, highlight in pairs(highlightedTrash) do
        if not table.find(currentTrash, trashPart) then
            if highlight then highlight:Destroy() end
            local label = trashPart:FindFirstChild("TrashLabel")
            if label then label:Destroy() end
            highlightedTrash[trashPart] = nil
        end
    end
end

-- ç§»é™¤åºŸæ–™çš„é«˜äº®å’Œæ ‡ç­¾
local function removeTrashEffects(trashPart)
    if highlightedTrash[trashPart] then
        highlightedTrash[trashPart]:Destroy()
        highlightedTrash[trashPart] = nil
    end
    
    local label = trashPart:FindFirstChild("TrashLabel")
    if label then
        label:Destroy()
    end
end

-- æ›´æ–°é™„è¿‘çš„åºŸæ–™æ˜¾ç¤º
local function updateNearbyTrash()
    if not trashEspEnabled then
        cleanUpHighlights({})
        return
    end
    
    if not humanoidRootPart or not humanoidRootPart:IsDescendantOf(workspace) then
        return
    end
    
    local currentTime = os.clock()
    if currentTime - lastScanTimeTrash > trashConfig.scanInterval then
        task.spawn(fullScanTrash)
    end
    
    local nearbyTrash = {}
    local playerPos = humanoidRootPart.Position
    
    -- æŒ‰è·ç¦»æ’åº
    table.sort(trashCache, function(a, b)
        return (playerPos - a.Position).Magnitude < (playerPos - b.Position).Magnitude
    end)
    
    -- å…ˆæ”¶é›†æ‰€æœ‰åœ¨èŒƒå›´å†…çš„åºŸæ–™
    local allNearby = {}
    for _, trashPart in ipairs(trashCache) do
        local distance = (playerPos - trashPart.Position).Magnitude
        if distance <= trashConfig.maxDistance then
            table.insert(allNearby, trashPart)
        end
    end
    
    -- æ£€æŸ¥å¯†é›†åŒºåŸŸ
    local denseAreas = {}
    for _, trashPart in ipairs(allNearby) do
        if isInDenseArea(trashPart, allNearby) then
            table.insert(denseAreas, trashPart)
            removeTrashEffects(trashPart)
        end
    end
    
    -- åªæ˜¾ç¤ºæœ€è¿‘çš„maxLabelsä¸ªåºŸæ–™ï¼Œæ’é™¤å¯†é›†åŒºåŸŸçš„åºŸæ–™
    local displayCount = 0
    for _, trashPart in ipairs(allNearby) do
        if displayCount >= trashConfig.maxLabels then break end
        
        -- è·³è¿‡å¯†é›†åŒºåŸŸçš„åºŸæ–™
        if not table.find(denseAreas, trashPart) then
            local distance = (playerPos - trashPart.Position).Magnitude
            table.insert(nearbyTrash, trashPart)
            highlightTrash(trashPart)
            local label = createTrashLabel(trashPart, distance)
            updateTrashLabel(trashPart, distance)
            displayCount = displayCount + 1
        end
    end
    
    cleanUpHighlights(nearbyTrash)
end

-- ===== ä¿¡å·æªé€è§†åŠŸèƒ½ =====
-- åˆ›å»ºæç¤ºGUI
local function createFlareGunNotificationGui()
    if flareGunNotificationGui then
        flareGunNotificationGui:Destroy()
    end
    
    flareGunNotificationGui = Instance.new("ScreenGui")
    flareGunNotificationGui.Name = "FlareGunNotifications"
    flareGunNotificationGui.Parent = LocalPlayer.PlayerGui
    flareGunNotificationGui.ResetOnSpawn = false
    flareGunNotificationGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    return flareGunNotificationGui
end

-- æ˜¾ç¤ºåˆ·æ–°æç¤º
local function showFlareGunRefreshNotification()
    if not flareGunEspEnabled then return end
    
    local currentTime = os.clock()
    
    -- æ£€æŸ¥å†·å´æ—¶é—´
    if currentTime - flareGunNotificationCooldown < flareGunConfig.notificationCooldown then
        return -- å†·å´æ—¶é—´å†…ä¸æ˜¾ç¤ºæç¤º
    end
    
    -- é˜²æ­¢é‡å¤æ˜¾ç¤º
    if currentTime - flareGunLastNotificationTime < flareGunConfig.notificationDuration then
        return
    end
    
    -- æ›´æ–°å†·å´æ—¶é—´å’Œæœ€åæç¤ºæ—¶é—´
    flareGunNotificationCooldown = currentTime
    flareGunLastNotificationTime = currentTime
    
    local gui = createFlareGunNotificationGui()
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.4, 0, 0.08, 0)
    frame.Position = UDim2.new(0.3, 0, 0.05, 0)
    frame.BackgroundColor3 = Color3.new(0, 0, 0)
    frame.BackgroundTransparency = 0.5
    frame.BorderSizePixel = 0
    frame.Parent = gui
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = "å·²åˆ·æ–°ä¿¡å·æª"
    textLabel.TextColor3 = flareGunConfig.notificationColor
    textLabel.TextSize = 24
    textLabel.Font = Enum.Font.SourceSansBold
    textLabel.TextStrokeTransparency = 0.5
    textLabel.TextStrokeColor3 = Color3.new(1, 1, 1)
    textLabel.Parent = frame
    
    -- æ·¡å…¥æ•ˆæœ
    frame.BackgroundTransparency = 1
    textLabel.TextTransparency = 1
    
    local fadeIn = TweenService:Create(
        frame,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {BackgroundTransparency = 0.5}
    )
    
    local textFadeIn = TweenService:Create(
        textLabel,
        TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
        {TextTransparency = 0}
    )
    
    fadeIn:Play()
    textFadeIn:Play()
    
    -- å»¶è¿Ÿåæ·¡å‡º
    task.delay(flareGunConfig.notificationDuration, function()
        if frame and frame.Parent then
            local fadeOut = TweenService:Create(
                frame,
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {BackgroundTransparency = 1}
            )
            
            local textFadeOut = TweenService:Create(
                textLabel,
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {TextTransparency = 1}
            )
            
            fadeOut:Play()
            textFadeOut:Play()
            
            fadeOut.Completed:Connect(function()
                if frame and frame.Parent then
                    frame:Destroy()
                end
            end)
        end
    end)
end

-- åˆ›å»ºä¿¡å·æªæ ‡ç­¾å‡½æ•°
local function createFlareGunLabel(itemPart, distanceInStuds)
    if not flareGunEspEnabled then return nil end
    
    if not itemPart:FindFirstChild("FlareGunLabel") then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "FlareGunLabel"
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.Adornee = itemPart
        billboard.MaxDistance = flareGunConfig.maxDistance
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = string.format("%s\n%.1fç±³", flareGunConfig.tagPrefix, studsToMeters(distanceInStuds))
        textLabel.TextColor3 = flareGunConfig.labelColor
        textLabel.TextSize = flareGunConfig.labelSize
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextStrokeTransparency = 0.5
        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        textLabel.Parent = billboard
        billboard.Parent = itemPart
        
        return billboard
    end
    return itemPart:FindFirstChild("FlareGunLabel")
end

-- æ›´æ–°ä¿¡å·æªæ ‡ç­¾è·ç¦»
local function updateFlareGunLabel(itemPart, distanceInStuds)
    if not flareGunEspEnabled then return end
    
    local label = itemPart:FindFirstChild("FlareGunLabel")
    if label then
        label.TextLabel.Text = string.format("%s\n%.1fç±³", flareGunConfig.tagPrefix, studsToMeters(distanceInStuds))
        
        -- æ ¹æ®è·ç¦»è°ƒæ•´æ ‡ç­¾å¤§å°
        local scale = math.clamp(1 - (distanceInStuds / flareGunConfig.maxDistance) * 0.5, 0.5, 1)
        label.TextLabel.TextSize = flareGunConfig.labelSize * scale
    end
end

-- é«˜äº®ä¿¡å·æªçš„å‡½æ•°
local function highlightFlareGunItem(itemPart)
    if not flareGunEspEnabled then return end
    
    if not flareGunHighlightedItems[itemPart] then
        local highlight = Instance.new("Highlight")
        highlight.Name = "FlareGunHighlight"
        highlight.FillColor = flareGunConfig.highlightColor
        highlight.FillTransparency = flareGunConfig.highlightTransparency
        highlight.OutlineColor = flareGunConfig.highlightColor
        highlight.OutlineTransparency = 0
        highlight.Adornee = itemPart
        highlight.Parent = itemPart
        
        flareGunHighlightedItems[itemPart] = highlight
    end
end

-- å…¨å›¾æ‰«æä¿¡å·æª
local function flareGunFullScan()
    if not flareGunEspEnabled then return end
    
    if flareGunScanning then return end
    flareGunScanning = true
    
    local startTime = os.clock()
    local previousCount = #flareGunItemCache
    flareGunItemCache = {}
    
    -- æœç´¢ä¿¡å·æªç›¸å…³å¯¹è±¡
    local flareGunKeywords = {"flaregun", "flare_gun", "flare", "signalgun", "signal_gun"}
    
    -- æ‰«æå·¥ä½œåŒº
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local lowerName = obj.Name:lower()
            for _, keyword in ipairs(flareGunKeywords) do
                if lowerName:find(keyword) then
                    table.insert(flareGunItemCache, obj)
                    break
                end
            end
        end
    end
    
    -- æ‰«ææ¨¡å‹
    for _, model in ipairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local lowerName = model.Name:lower()
            for _, keyword in ipairs(flareGunKeywords) do
                if lowerName:find(keyword) then
                    for _, part in ipairs(model:GetDescendants()) do
                        if part:IsA("BasePart") then
                            table.insert(flareGunItemCache, part)
                        end
                    end
                    break
                end
            end
        end
    end
    
    flareGunScanning = false
    flareGunLastScanTime = os.clock()
    
    local newCount = #flareGunItemCache
    print(string.format("[ä¿¡å·æª] å…¨å›¾æ‰«æå®Œæˆï¼Œæ‰¾åˆ° %d ä¸ªä¿¡å·æªç›¸å…³ç‰©å“ï¼Œè€—æ—¶ %.2f ç§’", newCount, os.clock() - startTime))
    
    -- å¦‚æœæ£€æµ‹åˆ°ä¿¡å·æªä¸”æ•°é‡æœ‰å˜åŒ–ï¼Œæ˜¾ç¤ºæç¤º
    if newCount > 0 and newCount ~= previousCount then
        showFlareGunRefreshNotification()
    end
end

-- æ¸…é™¤ä¸å†éœ€è¦çš„ä¿¡å·æªé«˜äº®
local function flareGunCleanUpHighlights(currentItems)
    for itemPart, highlight in pairs(flareGunHighlightedItems) do
        if not table.find(currentItems, itemPart) then
            if highlight then highlight:Destroy() end
            local label = itemPart:FindFirstChild("FlareGunLabel")
            if label then label:Destroy() end
            flareGunHighlightedItems[itemPart] = nil
        end
    end
end

-- æ›´æ–°é™„è¿‘çš„ä¿¡å·æªæ˜¾ç¤º
local function updateNearbyFlareGuns()
    if not flareGunEspEnabled then 
        flareGunCleanUpHighlights({})
        return 
    end
    
    if not humanoidRootPart or not humanoidRootPart:IsDescendantOf(workspace) then
        return
    end
    
    local currentTime = os.clock()
    if currentTime - flareGunLastScanTime > flareGunConfig.scanInterval then
        task.spawn(flareGunFullScan)
    end
    
    local nearbyItems = {}
    local playerPos = humanoidRootPart.Position
    
    -- æŒ‰è·ç¦»æ’åº
    table.sort(flareGunItemCache, function(a, b)
        return (playerPos - a.Position).Magnitude < (playerPos - b.Position).Magnitude
    end)
    
    -- åªæ˜¾ç¤ºæœ€è¿‘çš„maxLabelsä¸ªä¿¡å·æª
    local displayCount = 0
    for _, itemPart in ipairs(flareGunItemCache) do
        if displayCount >= flareGunConfig.maxLabels then break end
        
        local distance = (playerPos - itemPart.Position).Magnitude
        if distance <= flareGunConfig.maxDistance then
            table.insert(nearbyItems, itemPart)
            highlightFlareGunItem(itemPart)
            local label = createFlareGunLabel(itemPart, distance)
            updateFlareGunLabel(itemPart, distance)
            displayCount += 1
        end
    end
    
    flareGunCleanUpHighlights(nearbyItems)
end

-- ===== ç©ºæŠ•é€è§†åŠŸèƒ½ =====
-- æ£€æŸ¥åºŸæ–™æ˜¯å¦åœ¨ä¸æ˜¾ç¤ºåŒºåŸŸ
local function isInNoDisplayZone(partPosition)
    local zoneCenter = airdropConfig.noDisplayZone.center
    local zoneRadius = airdropConfig.noDisplayZone.radius
    return (partPosition - zoneCenter).Magnitude <= zoneRadius
end

-- åˆ›å»ºç©ºæŠ•æ ‡ç­¾å‡½æ•°
local function createAirdropLabel(trashPart, distanceInStuds)
    if not airdropEspEnabled then return nil end
    
    -- æ£€æŸ¥æ˜¯å¦åœ¨ä¸æ˜¾ç¤ºåŒºåŸŸ
    if isInNoDisplayZone(trashPart.Position) then
        return nil
    end
    
    if not trashPart:FindFirstChild("AirdropLabel") then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "AirdropLabel"
        billboard.AlwaysOnTop = true
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 2, 0)
        billboard.Adornee = trashPart
        billboard.MaxDistance = airdropConfig.maxDistance
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.Text = string.format("%s\n%.1fç±³", airdropConfig.denseArea.airdropPrefix, studsToMeters(distanceInStuds))
        textLabel.TextColor3 = airdropConfig.denseArea.airdropColor
        textLabel.TextSize = airdropConfig.labelSize
        textLabel.Font = Enum.Font.SourceSansBold
        textLabel.TextStrokeTransparency = 0.5
        textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
        
        textLabel.Parent = billboard
        billboard.Parent = trashPart
        
        airdropLabeledTrash[trashPart] = billboard
        return billboard
    end
    return trashPart:FindFirstChild("AirdropLabel")
end

-- æ›´æ–°ç©ºæŠ•æ ‡ç­¾è·ç¦»
local function updateAirdropLabel(trashPart, distanceInStuds)
    if not airdropEspEnabled then return end
    
    -- æ£€æŸ¥æ˜¯å¦åœ¨ä¸æ˜¾ç¤ºåŒºåŸŸ
    if isInNoDisplayZone(trashPart.Position) then
        local label = trashPart:FindFirstChild("AirdropLabel")
        if label then
            label:Destroy()
            airdropLabeledTrash[trashPart] = nil
        end
        return
    end
    
    local label = trashPart:FindFirstChild("AirdropLabel")
    if label then
        label.TextLabel.Text = string.format("%s\n%.1fç±³", airdropConfig.denseArea.airdropPrefix, studsToMeters(distanceInStuds))
        
        -- æ ¹æ®è·ç¦»è°ƒæ•´æ ‡ç­¾å¤§å°
        local scale = math.clamp(1 - (distanceInStuds / airdropConfig.maxDistance) * 0.5, 0.5, 1)
        label.TextLabel.TextSize = airdropConfig.labelSize * scale
    end
end

-- ç§»é™¤ç©ºæŠ•æ ‡ç­¾
local function removeAirdropLabel(trashPart)
    local label = trashPart:FindFirstChild("AirdropLabel")
    if label then
        label:Destroy()
        airdropLabeledTrash[trashPart] = nil
    end
end

-- æ£€æµ‹å¯†é›†åŒºåŸŸ
local function findDenseAreas(trashList)
    local denseAreas = {}
    local processed = {}
    
    for i, trash1 in ipairs(trashList) do
        if not processed[trash1] then
            local nearbyTrash = {}
            
            for j, trash2 in ipairs(trashList) do
                if i ~= j and not processed[trash2] then
                    local distance = (trash1.Position - trash2.Position).Magnitude
                    if distance <= airdropConfig.denseArea.radius then
                        table.insert(nearbyTrash, trash2)
                    end
                end
            end
            
            -- å¦‚æœæ‰¾åˆ°è¶³å¤Ÿå¤šçš„é™„è¿‘åºŸæ–™
            if #nearbyTrash >= airdropConfig.denseArea.threshold - 1 then
                table.insert(nearbyTrash, trash1)
                table.insert(denseAreas, nearbyTrash)
                
                -- æ ‡è®°è¿™äº›åºŸæ–™ä¸ºå·²å¤„ç†
                for _, trash in ipairs(nearbyTrash) do
                    processed[trash] = true
                end
            end
        end
    end
    
    return denseAreas
end

-- å…¨å›¾æ‰«æåºŸæ–™
local function airdropFullScan()
    if not airdropEspEnabled then return end
    
    if airdropScanning then return end
    airdropScanning = true
    
    local startTime = os.clock()
    airdropTrashCache = {}
    
    -- æ‰©å±•æœç´¢æ¡ä»¶
    local trashKeywords = {"trash", "scrap", "junk", "waste", "debris", "rubbish", "garbage", "åºŸæ–™", "åƒåœ¾"}
    
    -- æ‰«æå·¥ä½œåŒº
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local lowerName = obj.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    table.insert(airdropTrashCache, obj)
                    break
                end
            end
        end
    end
    
    -- æ‰«ææ¨¡å‹
    for _, model in ipairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local lowerName = model.Name:lower()
            for _, keyword in ipairs(trashKeywords) do
                if lowerName:find(keyword) then
                    for _, part in ipairs(model:GetDescendants()) do
                        if part:IsA("BasePart") then
                            table.insert(airdropTrashCache, part)
                        end
                    end
                    break
                end
            end
        end
    end
    
    airdropScanning = false
    airdropLastScanTime = os.clock()
    print(string.format("[ç©ºæŠ•] å…¨å›¾æ‰«æå®Œæˆï¼Œæ‰¾åˆ° %d ä¸ªåºŸæ–™ï¼Œè€—æ—¶ %.2f ç§’", #airdropTrashCache, os.clock() - startTime))
end

-- æ¸…é™¤ä¸å†éœ€è¦çš„ç©ºæŠ•æ ‡ç­¾
local function airdropCleanUpLabels(currentTrash)
    for trashPart, label in pairs(airdropLabeledTrash) do
        if not table.find(currentTrash, trashPart) then
            if label then label:Destroy() end
            airdropLabeledTrash[trashPart] = nil
        end
    end
end

-- æ›´æ–°é™„è¿‘çš„ç©ºæŠ•æ˜¾ç¤º
local function updateNearbyAirdrops()
    if not airdropEspEnabled then 
        airdropCleanUpLabels({})
        return 
    end
    
    if not humanoidRootPart or not humanoidRootPart:IsDescendantOf(workspace) then
        return
    end
    
    local currentTime = os.clock()
    if currentTime - airdropLastScanTime > airdropConfig.scanInterval then
        task.spawn(airdropFullScan)
    end
    
    local nearbyTrash = {}
    local playerPos = humanoidRootPart.Position
    
    -- æ£€æµ‹å¯†é›†åŒºåŸŸ
    local denseAreas = findDenseAreas(airdropTrashCache)
    local inDenseArea = {} -- æ ‡è®°å“ªäº›åºŸæ–™åœ¨å¯†é›†åŒºåŸŸä¸­
    
    for _, area in ipairs(denseAreas) do
        for _, trash in ipairs(area) do
            inDenseArea[trash] = true
        end
    end
    
    -- åªæ˜¾ç¤ºæœ€è¿‘çš„maxLabelsä¸ªç©ºæŠ•
    local displayCount = 0
    for _, trashPart in ipairs(airdropTrashCache) do
        if displayCount >= airdropConfig.maxLabels then break end
        
        local distance = (playerPos - trashPart.Position).Magnitude
        if distance <= airdropConfig.maxDistance then
            -- æ£€æŸ¥æ˜¯å¦åœ¨ä¸æ˜¾ç¤ºåŒºåŸŸ
            if isInNoDisplayZone(trashPart.Position) then
                -- åœ¨ä¸æ˜¾ç¤ºåŒºåŸŸï¼Œç§»é™¤æ‰€æœ‰æ ‡ç­¾
                removeAirdropLabel(trashPart)
                -- ä¸åŠ å…¥æ˜¾ç¤ºåˆ—è¡¨
            else
                -- æ£€æŸ¥æ˜¯å¦åœ¨å¯†é›†åŒºåŸŸ
                if inDenseArea[trashPart] then
                    -- å¦‚æœæ˜¯å¯†é›†åŒºåŸŸï¼Œåªå¤„ç†ç¬¬ä¸€ä¸ªåºŸæ–™ä½œä¸ºä»£è¡¨
                    local isFirstInArea = false
                    for _, area in ipairs(denseAreas) do
                        if area[1] == trashPart then
                            isFirstInArea = true
                            break
                        end
                    end
                    
                    if isFirstInArea then
                        table.insert(nearbyTrash, trashPart)
                        local label = createAirdropLabel(trashPart, distance)
                        if label then
                            updateAirdropLabel(trashPart, distance)
                        end
                        displayCount += 1
                    else
                        -- å¯†é›†åŒºåŸŸä¸­çš„å…¶ä»–åºŸæ–™ï¼Œç§»é™¤æ ‡ç­¾
                        removeAirdropLabel(trashPart)
                    end
                else
                    -- æ™®é€šåºŸæ–™ï¼Œç§»é™¤æ ‡ç­¾
                    removeAirdropLabel(trashPart)
                end
            end
        end
    end
    
    airdropCleanUpLabels(nearbyTrash)
end

-- ===== åœ†å½¢æ‚¬æµ®çª—ä¸åŠ¨ç”»æŒ‰é’® =====
local function createCircularMenu()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "CircularMenuGUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    
    -- åœ†å½¢ä¸»æŒ‰é’® - å±å¹•æ­£å³è¾¹ä¸­é—´ä½ç½®
    local mainButton = Instance.new("ImageButton")
    mainButton.Name = "MainButton"
    mainButton.Size = UDim2.new(0, 50, 0, 50)
    mainButton.Position = UDim2.new(1, -60, 0.5, -25)
    mainButton.AnchorPoint = Vector2.new(0, 0.5)
    mainButton.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    mainButton.AutoButtonColor = true
    
    -- åœ†å½¢å¤–è§‚
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = mainButton
    
    -- æ·»åŠ NYå›¾æ¡ˆ
    local nyLabel = Instance.new("TextLabel")
    nyLabel.Name = "NYLabel"
    nyLabel.Size = UDim2.new(1, 0, 1, 0)
    nyLabel.BackgroundTransparency = 1
    nyLabel.Text = "NY"
    nyLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    nyLabel.TextSize = 20
    nyLabel.Font = Enum.Font.SourceSansBold
    nyLabel.Parent = mainButton
    
    -- å‘å…‰æ•ˆæœ
    local glow = Instance.new("UIStroke")
    glow.Name = "Glow"
    glow.Color = Color3.fromRGB(100, 150, 255)
    glow.Thickness = 2
    glow.Transparency = 0.5
    glow.Parent = mainButton
    
    mainButton.Parent = screenGui
    
    -- é•¿æ–¹å½¢èœå•
    local rectangleMenu = Instance.new("Frame")
    rectangleMenu.Name = "RectangleMenu"
    rectangleMenu.Size = UDim2.new(0, 0, 0, 0)
    rectangleMenu.Position = UDim2.new(0.5, 0, 0.5, 0)
    rectangleMenu.AnchorPoint = Vector2.new(0.5, 0.5)
    rectangleMenu.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    rectangleMenu.BorderSizePixel = 0
    rectangleMenu.Visible = false
    rectangleMenu.ZIndex = 2
    
    -- é•¿æ–¹å½¢èœå•åœ†è§’
    local menuCorner = Instance.new("UICorner")
    menuCorner.CornerRadius = UDim.new(0, 8)
    menuCorner.Parent = rectangleMenu
    
    -- é•¿æ–¹å½¢èœå•è¾¹æ¡†
    local menuStroke = Instance.new("UIStroke")
    menuStroke.Color = Color3.fromRGB(80, 120, 200)
    menuStroke.Thickness = 2
    menuStroke.Parent = rectangleMenu
    
    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    titleBar.BorderSizePixel = 0
    titleBar.ZIndex = 3
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 8)
    titleCorner.Parent = titleBar
    
    -- æ ‡é¢˜æ–‡å­—
    local titleText = Instance.new("TextLabel")
    titleText.Name = "TitleText"
    titleText.Size = UDim2.new(1, -40, 1, 0)
    titleText.Position = UDim2.new(0, 10, 0, 0)
    titleText.BackgroundTransparency = 1
    titleText.Text = "NY èœå•"
    titleText.TextColor3 = Color3.fromRGB(200, 200, 255)
    titleText.TextSize = 16
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Font = Enum.Font.SourceSansBold
    titleText.ZIndex = 3
    titleText.Parent = titleBar
    
    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 1, 0)
    closeButton.Position = UDim2.new(1, -30, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    closeButton.BorderSizePixel = 0
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(200, 200, 255)
    closeButton.TextSize = 16
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.ZIndex = 3
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 8)
    closeCorner.Parent = closeButton
    
    closeButton.Parent = titleBar
    titleBar.Parent = rectangleMenu
    
    -- åˆ›å»ºæŒ‰é’®å®¹å™¨
    local buttonsContainer = Instance.new("Frame")
    buttonsContainer.Name = "ButtonsContainer"
    buttonsContainer.Size = UDim2.new(1, -20, 1, -40)
    buttonsContainer.Position = UDim2.new(0, 10, 0, 40)
    buttonsContainer.BackgroundTransparency = 1
    buttonsContainer.ZIndex = 3
    buttonsContainer.Parent = rectangleMenu
    
    -- åˆ›å»ºå·¦ä¾§æŒ‰é’®åˆ—
    local leftColumn = Instance.new("Frame")
    leftColumn.Name = "LeftColumn"
    leftColumn.Size = UDim2.new(0.45, 0, 1, 0)
    leftColumn.Position = UDim2.new(0, 0, 0, 0)
    leftColumn.BackgroundTransparency = 1
    leftColumn.ZIndex = 3
    leftColumn.Parent = buttonsContainer
    
    -- åˆ›å»ºå³ä¾§æŒ‰é’®åˆ—
    local rightColumn = Instance.new("Frame")
    rightColumn.Name = "RightColumn"
    rightColumn.Size = UDim2.new(0.45, 0, 1, 0)
    rightColumn.Position = UDim2.new(0.55, 0, 0, 0)
    rightColumn.BackgroundTransparency = 1
    rightColumn.ZIndex = 3
    rightColumn.Parent = buttonsContainer
    
    -- åˆ›å»ºç©å®¶ESPå¼€å…³æŒ‰é’®ï¼ˆå·¦ä¾§ï¼‰
    local playerEspButton = Instance.new("TextButton")
    playerEspButton.Name = "PlayerESPButton"
    playerEspButton.Size = UDim2.new(1, 0, 0, 30)
    playerEspButton.Position = UDim2.new(0, 0, 0, 0)
    playerEspButton.BackgroundColor3 = playerEspEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(100, 100, 100)
    playerEspButton.Text = playerEspEnabled and "ç©å®¶é€è§†å¼€å¯" or "ç©å®¶é€è§†å…³é—­"
    playerEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    playerEspButton.TextSize = 14
    playerEspButton.Font = Enum.Font.SourceSansBold
    playerEspButton.AutoButtonColor = true
    playerEspButton.ZIndex = 3
    
    -- åœ†è§’
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0.2, 0)
    buttonCorner.Parent = playerEspButton
    
    -- åˆ›å»ºæ•ŒäººESPå¼€å…³æŒ‰é’®ï¼ˆå·¦ä¾§ï¼‰
    local enemyEspButton = Instance.new("TextButton")
    enemyEspButton.Name = "EnemyESPButton"
    enemyEspButton.Size = UDim2.new(1, 0, 0, 30)
    enemyEspButton.Position = UDim2.new(0, 0, 0, 40)
    enemyEspButton.BackgroundColor3 = enemyEspEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(100, 100, 100)
    enemyEspButton.Text = enemyEspEnabled and "Rakeé€è§†å¼€å¯" or "Rakeé€è§†å…³é—­"
    enemyEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    enemyEspButton.TextSize = 14
    enemyEspButton.Font = Enum.Font.SourceSansBold
    enemyEspButton.AutoButtonColor = true
    enemyEspButton.ZIndex = 3
    
    local buttonCorner2 = Instance.new("UICorner")
    buttonCorner2.CornerRadius = UDim.new(0.2, 0)
    buttonCorner2.Parent = enemyEspButton
    
    -- åˆ›å»ºåºŸæ–™ESPå¼€å…³æŒ‰é’®ï¼ˆå·¦ä¾§ï¼‰
    local trashEspButton = Instance.new("TextButton")
    trashEspButton.Name = "TrashESPButton"
    trashEspButton.Size = UDim2.new(1, 0, 0, 30)
    trashEspButton.Position = UDim2.new(0, 0, 0, 80)
    trashEspButton.BackgroundColor3 = trashEspEnabled and Color3.fromRGB(150, 75, 0) or Color3.fromRGB(100, 100, 100)
    trashEspButton.Text = trashEspEnabled and "åºŸæ–™é€è§†å¼€å¯" or "åºŸæ–™é€è§†å…³é—­"
    trashEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    trashEspButton.TextSize = 14
    trashEspButton.Font = Enum.Font.SourceSansBold
    trashEspButton.AutoButtonColor = true
    trashEspButton.ZIndex = 3
    
    local buttonCorner3 = Instance.new("UICorner")
    buttonCorner3.CornerRadius = UDim.new(0.2, 0)
    buttonCorner3.Parent = trashEspButton
    
    -- åˆ›å»ºä¿¡å·æªé€è§†å¼€å…³æŒ‰é’®ï¼ˆå·¦ä¾§ï¼‰
    local flareGunEspButton = Instance.new("TextButton")
    flareGunEspButton.Name = "FlareGunESPButton"
    flareGunEspButton.Size = UDim2.new(1, 0, 0, 30)
    flareGunEspButton.Position = UDim2.new(0, 0, 0, 120)
    flareGunEspButton.BackgroundColor3 = flareGunEspEnabled and Color3.fromRGB(255, 100, 100) or Color3.fromRGB(100, 100, 100)
    flareGunEspButton.Text = flareGunEspEnabled and "ä¿¡å·æªé€è§†å¼€å¯" or "ä¿¡å·æªé€è§†å…³é—­"
    flareGunEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    flareGunEspButton.TextSize = 14
    flareGunEspButton.Font = Enum.Font.SourceSansBold
    flareGunEspButton.AutoButtonColor = true
    flareGunEspButton.ZIndex = 3
    
    local buttonCorner4 = Instance.new("UICorner")
    buttonCorner4.CornerRadius = UDim.new(0.2, 0)
    buttonCorner4.Parent = flareGunEspButton
    
    -- åˆ›å»ºå¤œè§†å¼€å…³æŒ‰é’®ï¼ˆå³ä¾§ï¼‰
    local nightVisionToggleButton = Instance.new("TextButton")
    nightVisionToggleButton.Name = "NightVisionToggleButton"
    nightVisionToggleButton.Size = UDim2.new(1, 0, 0, 30)
    nightVisionToggleButton.Position = UDim2.new(0, 0, 0, 0)
    nightVisionToggleButton.BackgroundColor3 = nightVisionEnabled and Color3.fromRGB(50, 200, 200) or Color3.fromRGB(100, 100, 100)
    nightVisionToggleButton.Text = nightVisionEnabled and "å¤œè§†å¼€å¯" or "å¤œè§†å…³é—­"
    nightVisionToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    nightVisionToggleButton.TextSize = 14
    nightVisionToggleButton.Font = Enum.Font.SourceSansBold
    nightVisionToggleButton.AutoButtonColor = true
    nightVisionToggleButton.ZIndex = 3
    
    local buttonCorner5 = Instance.new("UICorner")
    buttonCorner5.CornerRadius = UDim.new(0.2, 0)
    buttonCorner5.Parent = nightVisionToggleButton
    
    -- åˆ›å»ºé€Ÿåº¦æ§åˆ¶æŒ‰é’®ï¼ˆå³ä¾§ï¼‰
    local speedToggleButton = Instance.new("TextButton")
    speedToggleButton.Name = "SpeedToggleButton"
    speedToggleButton.Size = UDim2.new(1, 0, 0, 30)
    speedToggleButton.Position = UDim2.new(0, 0, 0, 40)
    speedToggleButton.BackgroundColor3 = isSpeedBoostEnabled and Color3.fromRGB(255, 165, 0) or Color3.fromRGB(100, 100, 100)
    speedToggleButton.Text = isSpeedBoostEnabled and "é€Ÿåº¦å¼€å¯" or "é€Ÿåº¦å…³é—­"
    speedToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    speedToggleButton.TextSize = 14
    speedToggleButton.Font = Enum.Font.SourceSansBold
    speedToggleButton.AutoButtonColor = true
    speedToggleButton.ZIndex = 3
    
    local buttonCorner6 = Instance.new("UICorner")
    buttonCorner6.CornerRadius = UDim.new(0.2, 0)
    buttonCorner6.Parent = speedToggleButton
    
    -- åˆ›å»ºåœ°ç‚¹æ ‡è®°æŒ‰é’®ï¼ˆå³ä¾§ï¼‰
    local locationMarkersButton = Instance.new("TextButton")
    locationMarkersButton.Name = "LocationMarkersButton"
    locationMarkersButton.Size = UDim2.new(1, 0, 0, 30)
    locationMarkersButton.Position = UDim2.new(0, 0, 0, 80)
    locationMarkersButton.BackgroundColor3 = isLocationMarkersEnabled and Color3.fromRGB(170, 0, 255) or Color3.fromRGB(100, 100, 100)
    locationMarkersButton.Text = isLocationMarkersEnabled and "åœ°ç‚¹æ ‡è®°å¼€å¯" or "åœ°ç‚¹æ ‡è®°å…³é—­"
    locationMarkersButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    locationMarkersButton.TextSize = 14
    locationMarkersButton.Font = Enum.Font.SourceSansBold
    locationMarkersButton.AutoButtonColor = true
    locationMarkersButton.ZIndex = 3
    
    local buttonCorner7 = Instance.new("UICorner")
    buttonCorner7.CornerRadius = UDim.new(0.2, 0)
    buttonCorner7.Parent = locationMarkersButton
    
    -- åˆ›å»ºç©ºæŠ•é€è§†å¼€å…³æŒ‰é’®ï¼ˆå³ä¾§ - ç¬¬å››ä¸ªä½ç½®ï¼‰
    local airdropEspButton = Instance.new("TextButton")
    airdropEspButton.Name = "AirdropESPButton"
    airdropEspButton.Size = UDim2.new(1, 0, 0, 30)
    airdropEspButton.Position = UDim2.new(0, 0, 0, 120) -- ç¬¬å››ä¸ªä½ç½®
    airdropEspButton.BackgroundColor3 = airdropEspEnabled and Color3.fromRGB(139, 0, 0) or Color3.fromRGB(100, 100, 100)
    airdropEspButton.Text = airdropEspEnabled and "ç©ºæŠ•é€è§†å¼€å¯" or "ç©ºæŠ•é€è§†å…³é—­"
    airdropEspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    airdropEspButton.TextSize = 14
    airdropEspButton.Font = Enum.Font.SourceSansBold
    airdropEspButton.AutoButtonColor = true
    airdropEspButton.ZIndex = 3
    
    local buttonCorner8 = Instance.new("UICorner")
    buttonCorner8.CornerRadius = UDim.new(0.2, 0)
    buttonCorner8.Parent = airdropEspButton
    
    -- å°†æŒ‰é’®æ·»åŠ åˆ°å„è‡ªçš„åˆ—
    playerEspButton.Parent = leftColumn
    enemyEspButton.Parent = leftColumn
    trashEspButton.Parent = leftColumn
    flareGunEspButton.Parent = leftColumn
    
    nightVisionToggleButton.Parent = rightColumn
    speedToggleButton.Parent = rightColumn
    locationMarkersButton.Parent = rightColumn
    airdropEspButton.Parent = rightColumn -- æ·»åŠ åˆ°å³ä¾§
    
    rectangleMenu.Parent = screenGui
    
    -- èœå•çŠ¶æ€
    local rectangleVisible = false
    
    -- æ˜¾ç¤ºé•¿æ–¹å½¢èœå•çš„å‡½æ•°
    local function showRectangleMenu()
        rectangleVisible = true
        rectangleMenu.Visible = true
        
        -- åŠ¨ç”»æ•ˆæœï¼šä»ä¸­å¿ƒå±•å¼€
        local expandTween = TweenService:Create(
            rectangleMenu,
            TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 300, 0, 220)}
        )
        expandTween:Play()
    end
    
    -- éšè—é•¿æ–¹å½¢èœå•çš„å‡½æ•°
    local function hideRectangleMenu()
        rectangleVisible = false
        
        -- åŠ¨ç”»æ•ˆæœï¼šæ”¶ç¼©åˆ°ä¸­å¿ƒ
        local collapseTween = TweenService:Create(
            rectangleMenu,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(0, 0, 0, 0)}
        )
        collapseTween:Play()
        
        -- å»¶è¿Ÿåéšè—èœå•
        task.delay(0.3, function()
            if not rectangleVisible then
                rectangleMenu.Visible = false
            end
        end)
    end
    
    -- ä¸»æŒ‰é’®ç‚¹å‡»äº‹ä»¶ - æ˜¾ç¤ºé•¿æ–¹å½¢èœå•
    mainButton.MouseButton1Click:Connect(function()
        if not rectangleVisible then
            showRectangleMenu()
        else
            hideRectangleMenu()
        end
    end)
    
    -- å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    closeButton.MouseButton1Click:Connect(hideRectangleMenu)
    
    -- ç©å®¶ESPæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    playerEspButton.MouseButton1Click:Connect(function()
        playerEspEnabled = not playerEspEnabled
        
        playerEspButton.BackgroundColor3 = playerEspEnabled and Color3.fromRGB(50, 200, 80) or Color3.fromRGB(100, 100, 100)
        playerEspButton.Text = playerEspEnabled and "ç©å®¶é€è§†å¼€å¯" or "ç©å®¶é€è§†å…³é—­"
        
        -- æ›´æ–°æ‰€æœ‰ç©å®¶ESPçš„æ˜¾ç¤ºçŠ¶æ€
        for target, data in pairs(espCache) do
            if not data.isEnemy then
                local shouldShow = shouldShowESP(target, data)
                if data.highlight then
                    data.highlight.Enabled = shouldShow
                end
                if data.billboard then
                    data.billboard.Enabled = shouldShow
                end
                if data.tracer then
                    data.tracer.Enabled = shouldShow
                end
            end
        end
    end)
    
    -- æ•ŒäººESPæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    enemyEspButton.MouseButton1Click:Connect(function()
        enemyEspEnabled = not enemyEspEnabled
        
        enemyEspBæ‰€æœ‰æ•ŒäººESPçš„æ˜¾ç¤ºçŠ¶æ€
        for target, data in pairs(espCache) do
            if data.isEnemy then
                local shouldShow = shouldShowESP(target, data)
                if data.highlight then
                    data.highlight.Enabled = shouldShow
                end
                if data.billboard then
                    data.billboard.Enabled = shouldShow
                end
                if data.tracer then
                    data.tracer.Enabled = shouldShow
                end
            end
        end
    end)
    
    -- åºŸæ–™ESPæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    trashEspButton.MouseButton1Click:Connect(function()
        trashEspEnabled = not trashEspEnabled
        
        trashEspButton.BackgroundColor3 = trashEspEnabled and Color3.fromRGB(150, 75, 0) or Color3.fromRGB(100, 100, 100)
        trashEspButton.Text = trashEspEnabled and "åºŸæ–™é€è§†å¼€å¯" or "åºŸæ–™é€è§†å…³é—­"
        
        if not trashEspEnabled then
            -- æ¸…é™¤æ‰€æœ‰åºŸæ–™é«˜äº®
            for trashPart, highlight in pairs(highlightedTrash) do
                if highlight then highlight:Destroy() end
                local label = trashPart:FindFirstChild("TrashLabel")
                if label then label:Destroy() end
                highlightedTrash[trashPart] = nil
            end
        else
            -- é‡æ–°æ‰«æåºŸæ–™
            task.spawn(fullScanTrash)
        end
    end)
    
    -- ä¿¡å·æªé€è§†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    flareGunEspButton.MouseButton1Click:Connect(function()
        flareGunEspEnabled = not flareGunEspEnabled
        
        flareGunEspButton.BackgroundColor3 = flareGunEspEnabled and Color3.fromRGB(255, 100, 100) or Color3.fromRGB(100, 100, 100)
        flareGunEspButton.Text = flareGunEspEnabled and "ä¿¡å·æªé€è§†å¼€å¯" or "ä¿¡å·æªé€è§†å…³é—­"
        
        if not flareGunEspEnabled then
            -- æ¸…é™¤æ‰€æœ‰ä¿¡å·æªé«˜äº®
            for itemPart, highlight in pairs(flareGunHighlightedItems) do
                if highlight then highlight:Destroy() end
                local label = itemPart:FindFirstChild("FlareGunLabel")
                if label then label:Destroy() end
                flareGunHighlightedItems[itemPart] = nil
            end
        else
            -- é‡æ–°æ‰«æä¿¡å·æª
            task.spawn(flareGunFullScan)
        end
    end)
    
    -- å¤œè§†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    nightVisionToggleButton.MouseButton1Click:Connect(function()
        local newState = toggleNightVision()
        
        nightVisionToggleButton.BackgroundColor3 = newState and Color3.fromRGB(50, 200, 200) or Color3.fromRGB(100, 100, 100)
        nightVisionToggleButton.Text = newState and "å¤œè§†å¼€å¯" or "å¤œè§†å…³é—­"
    end)
    
    -- é€Ÿåº¦æ§åˆ¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    speedToggleButton.MouseButton1Click:Connect(function()
        local newState = toggleSpeedBoost()
        
        speedToggleButton.BackgroundColor3 = newState and Color3.fromRGB(255, 165, 0) or Color3.fromRGB(100, 100, 100)
        speedToggleButton.Text = newState and "é€Ÿåº¦æå‡å¼€å¯" or "é€Ÿåº¦æå‡å…³é—­"
    end)
    
    -- åœ°ç‚¹æ ‡è®°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    locationMarkersButton.MouseButton1Click:Connect(function()
        local newState = toggleLocationMarkers()
        
        locationMarkersButton.BackgroundColor3 = newState and Color3.fromRGB(170, 0, 255) or Color3.fromRGB(100, 100, 100)
        locationMarkersButton.Text = newState and "åœ°ç‚¹æ ‡è®°å¼€å¯" or "åœ°ç‚¹æ ‡è®°å…³é—­"
    end)
    
    -- ç©ºæŠ•é€è§†æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    airdropEspButton.MouseButton1Click:Connect(function()
        airdropEspEnabled = not airdropEspEnabled
        
        airdropEspButton.BackgroundColor3 = airdropEspEnabled and Color3.fromRGB(139, 0, 0) or Color3.fromRGB(100, 100, 100)
        airdropEspButton.Text = airdropEspEnabled and "ç©ºæŠ•é€è§†å¼€å¯" or "ç©ºæŠ•é€è§†å…³é—­"
        
        if not airdropEspEnabled then
            -- æ¸…é™¤æ‰€æœ‰ç©ºæŠ•æ ‡ç­¾
            for trashPart, label in pairs(airdropLabeledTrash) do
                if label then label:Destroy() end
                airdropLabeledTrash[trashPart] = nil
            end
        else
            -- é‡æ–°æ‰«æç©ºæŠ•
            task.spawn(airdropFullScan)
        end
    end)
    
    -- ä¿®å¤åçš„æ‹–æ‹½åŠŸèƒ½
    local dragging = false
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        
        local absoluteX = startPos.X.Offset + (startPos.X.Scale * screenGui.AbsoluteSize.X)
        local absoluteY = startPos.Y.Offset + (startPos.Y.Scale * screenGui.AbsoluteSize.Y)
        
        local newX = absoluteX + delta.X
        local newY = absoluteY + delta.Y
        
        newX = math.clamp(newX, 0, screenGui.AbsoluteSize.X - mainButton.AbsoluteSize.X)
        newY = math.clamp(newY, 0, screenGui.AbsoluteSize.Y - mainButton.AbsoluteSize.Y)
        
        local relativeX = newX / screenGui.AbsoluteSize.X
        local relativeY = newY / screenGui.AbsoluteSize.Y
        
        mainButton.Position = UDim2.new(relativeX, 0, relativeY, 0)
    end
    
    mainButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainButton.Position
            
            local connection
            connection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    connection:Disconnect()
                end
            end)
        end
    end)
    
    mainButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
    
    return screenGui
end

-- ===== äº‹ä»¶å¤„ç† =====
-- è®¾ç½®å¿«æ·é”®
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed then
        if input.KeyCode == flareGunConfig.scanKey and flareGunEspEnabled then
            flareGunFullScan()
        elseif input.KeyCode == airdropConfig.scanKey and airdropEspEnabled then
            airdropFullScan()
        elseif input.KeyCode == trashConfig.scanKey and trashEspEnabled then
            fullScanTrash()
        end
    end
end)

-- ä¸»å¾ªç¯
RunService.Heartbeat:Connect(function(deltaTime)
    -- ESPæ›´æ–°
    lastUpdate = lastUpdate + deltaTime
    lastScanTime = lastScanTime + deltaTime
    
    if lastScanTime >= SETTINGS.SCAN_INTERVAL then
        lastScanTime = 0
        fullScan()
    end
    
    if lastUpdate < SETTINGS.UPDATE_RATE then return end
    lastUpdate = 0
    
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    local localRoot = LocalPlayer.Character.HumanoidRootPart
    
    for target, data in pairs(espCache) do
        if not target.Parent then
            if data.highlight then data.highlight:Destroy() end
            if data.billboard then data.billboard:Destroy() end
            if data.tracer then data.tracer:Destroy() end
            espCache[target] = nil
        else
            local distance = (data.rootPart.Position - localRoot.Position).Magnitude
            local distanceInMeters = distance / 3.571
            local shouldShow = distance <= SETTINGS.MAX_DISTANCE and shouldShowESP(target, data)
            
            data.billboard.Enabled = shouldShow
            if data.tracer then
                data.tracer.Enabled = shouldShow
                if data.startAttachment then
                    data.startAttachment.WorldPosition = localRoot.Position - Vector3.new(0, 1.5, 0)
                end
            end
            
            if shouldShow then
                if distanceInMeters < SETTINGS.HIGHLIGHT_DISABLE_DISTANCE then
                    data.highlight.Enabled = false
                else
                    data.highlight.Enabled = true
                end
            else
                data.highlight.Enabled = false
            end
            
            if shouldShow then
                if SETTINGS.SHOW_DISTANCE then
                    data.billboard.ESP_Distance.Text = string.format("%.1fm", distanceInMeters)
                else
                    data.billboard.ESP_Distance.Text = ""
                end
                
                if SETTINGS.SHOW_HEALTH and data.humanoid then
                    data.billboard.ESP_Health.Text = string.format("HP: %d/%d", 
                        math.floor(data.humanoid.Health), 
                        math.floor(data.humanoid.MaxHealth))
                else
                    data.billboard.ESP_Health.Text = ""
                end
                
                data.billboard.ESP_Name.Text = target.Name
            end
        end
    end
    
    -- å…¶ä»–åŠŸèƒ½æ›´æ–°
    updateNearbyTrash()
    updateNearbyFlareGuns()
    updateNearbyAirdrops()
end)

-- ç©å®¶é‡ç”Ÿæ—¶é‡æ–°è·å–è§’è‰²
LocalPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    
    -- é‡æ–°åˆ›å»ºä¿¡å·æªæç¤ºGUI
    createFlareGunNotificationGui()
    
    -- é‡æ–°åˆå§‹åŒ–é€Ÿåº¦æ§åˆ¶
    initializeCharacter(newChar)
end)

-- ===== åˆå§‹åŒ– =====
-- åˆå§‹åˆ›å»ºä¿¡å·æªæç¤ºGUI
createFlareGunNotificationGui()

-- åˆ›å»ºåœ†å½¢èœå•
createCircularMenu()

-- åˆå§‹æ‰«æï¼ˆåªåœ¨å¼€å¯çŠ¶æ€ä¸‹æ‰§è¡Œï¼‰
task.spawn(function()
    -- åˆå§‹çŠ¶æ€ä¸ºå…³é—­ï¼Œä¸æ‰§è¡Œæ‰«æ
    -- ç”¨æˆ·ç‚¹å‡»æŒ‰é’®å¼€å¯åä¼šè‡ªåŠ¨æ‰§è¡Œæ‰«æ
end)

print("é«˜çº§æ¸¸æˆè¾…åŠ©è„šæœ¬å·²æ¿€æ´»")
print("ä½¿ç”¨å±å¹•å³ä¾§çš„åœ†å½¢æŒ‰é’®æ‰“å¼€èœå•")
print(string.format("æŒ‰ %s é”®æ‰‹åŠ¨è§¦å‘ä¿¡å·æªæ‰«æ", flareGunConfig.scanKey.Name))
print(string.format("æŒ‰ %s é”®æ‰‹åŠ¨è§¦å‘ç©ºæŠ•æ‰«æ", airdropConfig.scanKey.Name))
print(string.format("æŒ‰ %s é”®æ‰‹åŠ¨è§¦å‘åºŸæ–™æ‰«æ", trashConfig.scanKey.Name))
print(string.format("å·²è®¾ç½®æ— æ˜¾ç¤ºåŒºåŸŸ: åæ ‡(%.2f, %.2f, %.2f), åŠå¾„%dstud", 
    airdropConfig.noDisplayZone.center.X, airdropConfig.noDisplayZone.center.Y, airdropConfig.noDisplayZone.center.Z, 
    airdropConfig.noDisplayZone.radius))
print(string.format("å·²è®¾ç½®å¯†é›†åŒºåŸŸæ£€æµ‹: åŠå¾„%dstud, é˜ˆå€¼%dä¸ªåºŸæ–™", 
    airdropConfig.denseArea.radius, airdropConfig.denseArea.threshold))

-- æ‰€æœ‰åŠŸèƒ½é»˜è®¤å…³é—­
print("æ‰€æœ‰åŠŸèƒ½é»˜è®¤å·²å…³é—­:")
print("ç©å®¶ESP: " .. (playerEspEnabled and "å¼€å¯" or "å…³é—­"))
print("æ•ŒäººESP: " .. (enemyEspEnabled and "å¼€å¯" or "å…³é—­"))
print("åºŸæ–™ESP: " .. (trashEspEnabled and "å¼€å¯" or "å…³é—­"))
print("ä¿¡å·æªé€è§†: " .. (flareGunEspEnabled and "å¼€å¯" or "å…³é—­"))
print("ç©ºæŠ•é€è§†: " .. (airdropEspEnabled and "å¼€å¯" or "å…³é—­"))
print("é€Ÿåº¦æå‡: " .. (isSpeedBoostEnabled and "å¼€å¯" or "å…³é—­"))
print("åœ°ç‚¹æ ‡è®°: " .. (isLocationMarkersEnabled and "å¼€å¯" or "å…³é—­"))
print("å¤œè§†åŠŸèƒ½: " .. (nightVisionEnabled and "å¼€å¯" or "å…³é—­"))

-- åœ¨è¿™é‡Œæ‹¼æ¥ä½ çš„ä¸»è„šæœ¬
-- ä½ çš„ä¸»è„šæœ¬å†…å®¹ä»è¿™é‡Œå¼€å§‹...
--è‡ªåŠ¨å–Šè¯--
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- ç­‰å¾…ç©å®¶åŠ å…¥
local player = Players.LocalPlayer
if not player then
    Players.PlayerAdded:Wait()
    player = Players.LocalPlayer
end

-- ç­‰å¾…è§’è‰²åŠ è½½
if not player.Character then
    player.CharacterAdded:Wait()
end

-- å‘é€æ¶ˆæ¯çš„å‡½æ•°
local function sendMessageMultipleTimes(message, times, interval)
    for i = 1, times do
        task.wait(interval)
        
        -- æ£€æŸ¥æ–°çš„TextChatServiceç³»ç»Ÿæ˜¯å¦å¯ç”¨
        if TextChatService then
            -- ä½¿ç”¨æ–°çš„TextChatServiceç³»ç»Ÿ
            local channel = TextChatService.TextChannels.RBXGeneral
            if channel then
                channel:SendAsync(message)
            else
                warn("æ— æ³•æ‰¾åˆ°é€šç”¨èŠå¤©é¢‘é“")
            end
        else
            -- å›é€€åˆ°æ—§ç‰ˆèŠå¤©ç³»ç»Ÿï¼ˆå¦‚æœå¯ç”¨ï¼‰
            local sayMessageRequest = ReplicatedStorage:FindFirstChild("SayMessageRequest")
            if sayMessageRequest then
                sayMessageRequest:FireServer(message, "All")
            else
                warn("æ— æ³•æ‰¾åˆ°SayMessageRequestï¼ŒèŠå¤©ç³»ç»Ÿå¯èƒ½ä¸å¯ç”¨")
            end
        end
    end
end

-- ç­‰å¾…TextChatServiceåˆå§‹åŒ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
if TextChatService and not TextChatService.TextChannels:FindFirstChild("RBXGeneral") then
    TextChatService.TextChannels.ChildAdded:Connect(function(child)
        if child.Name == "RBXGeneral" then
            task.wait(0.5) -- é¢å¤–ç­‰å¾…0.5ç§’ç¡®ä¿é¢‘é“å®Œå…¨åˆå§‹åŒ–
            sendMessageMultipleTimes("NuoYaæœ€å¸…", 3, 0.1)
        end
    end)
else
    -- å¦‚æœé¢‘é“å·²ç»å­˜åœ¨æˆ–ä½¿ç”¨æ—§ç‰ˆç³»ç»Ÿï¼Œç›´æ¥å‘é€æ¶ˆæ¯
    task.wait(1) -- ç­‰å¾…1ç§’ç¡®ä¿ç©å®¶å®Œå…¨åŠ è½½
    sendMessageMultipleTimes("è¯ºäºšæœ€å¸…", 3, 0.1)
end